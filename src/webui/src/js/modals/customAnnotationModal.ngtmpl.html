<sectionbox color="green" modal="true" on-close="vm.modal.close">
  <titlebar>
    <h3 class="title">{{vm.title}}</h3>
  </titlebar>
  <controls>
    <section class="line-wrapper pinned-right">
      <button type="button" ng-click="vm.modal.close(false)">Cancel</button>
      <button type="button" ng-click="vm.save()">Save</button>
    </section>
  </controls>
  <contentwrapper>
    <section ng-if="vm.category == 'references'">
      <article class="sectionbox-content allele-control-bar">
        <contentbox title="references" collapsible="false" class="max-width">
          <cbbody>
            <article class="content-box" ng-repeat="ref in vm.getCurrent()">
              <section class="line-wrapper">
                <div>
                  <h5 class="wrap">{{vm.getReference(ref.pubmed_id).title}}</h5>
                  <p>{{vm.getReference(ref.pubmed_id).getShortDesc()}}</p>
                </div>
                <div><button class="pink" ng-click="vm.removeReference(ref)">REMOVE</button></div>
            </article>
          </cbbody>
        </contentbox>
      </article>
      <div class="question line-wrapper">
        <div class="right">
          <h5 class="slim title"><b>Instructions</b></h5>
          <p>First, select a variant in the dropdown below. Next, find the reference on PubMed - ensure only one reference is displayed - then select XML from the drop-down menu labeled <b>Abstract</b>. Copy the entire contents of that page and paste it below in "Abstract XML data":</p>
        </div>
      </div>
      <div class="question line-wrapper" ng-if="vm.alleles.length > 1">
          <div class="left"> <h5>VARIANT:</h5> </div>
          <div class="right">
            <div class="dropdown">
              <select class='dropdown' ng-options="al as vm.formatAllele(al) for al in vm.alleles" ng-model="vm.selected_allele" ng-change="vm.copyAlleleCustomAnnotation()"><option value="" disabled selected>Choose variant</option></select>
            </div>
          </div>
      </div>
      <div class="question small">
        <autosize-textarea class="big" ng-model="vm.reference_xml" placeholder="ABSTRACT XML DATA"></autosize-textarea>
      </div>
      <div class="question small">
        <h5 class="error" ng-if="vm.reference_error">The pasted text is not valid Pubmed XML. Please check that you pasted it correctly.</h5>
      </div>
      <button class="green" ng-click="vm.addReference()" ng-disabled="vm.reference_xml === ''">
        <svg id="i-plus" class="buttonmark" viewBox="0 0 32 32" width="32" height="32" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
            <path d="M16 2 L16 30 M2 16 L30 16" />
        </svg>
        Add reference</button>
    </section>

    <section ng-if="vm.category == 'external' || vm.category == 'prediction'">
      <article class="sectionbox-content allele-control-bar">
        <contentbox title="other" collapsible="false" class="max-width">
          <cbbody>
            <div class="cb-table">
              <div class="tabular-row" ng-repeat="group in vm.config.custom_annotation[vm.category]" ng-if="vm.getCurrent()[group.key]">
                <div class="cell"><h5>{{group.name}}: </h5></div>
                <div class="cell"><p>{{vm.getCurrent()[group.key]}}</p></div>
                <div class="cell"><button class="remove" ng-click="vm.removeEntry(group.key)">REMOVE</button></div>
              </div>
            </div>
          </cbbody>
        </contentbox>
      </article>
      <article class="question small line-wrapper" ng-if="vm.alleles.length > 1">
        <div class="left"> <h5>Variant:</h5> </div>
        <div class="right">
          <div class="dropdown">
            <select ng-options="al as vm.formatAllele(al) for al in vm.alleles" ng-model="vm.selected_allele" ng-change="vm.copyAlleleCustomAnnotation()"><option value="" disabled selected>Choose variant</option></select>
          </div>
        </div>
      </article>
      <article class="question small line-wrapper">
        <div class="left"> <h5>Annotation:</h5> </div>
        <div class="right">
          <div class="dropdown">
            <select ng-options="group as group.name for group in vm.getAnnotationGroups()" ng-model="vm.selected_annotation_group"><option value="" disabled selected>Choose annotation</option></select>
          </div>
        </div>
      </article>
      <article class="question small line-wrapper">
        <div class="left"> <h5>Value:</h5> </div>
        <div class="right">
          <div class="dropdown">
            <select ng-if="vm.selected_annotation_group.options" ng-options="v as v[0] for v in vm.selected_annotation_group.options" ng-model="vm.selected_annotation_value"><option value="" disabled selected>Choose value</option></select>
          </div>
          <autosize-textarea placeholder="ENTER VALUE" ng-model="vm.selected_annotation_value" ng-if="vm.selected_annotation_group.text"> </autosize-textarea>
        </div>
      </article>
      <article class="question small line-wrapper">
        <div class="left">
          <div ng-if="vm.getUrls().length" ng-repeat="url in vm.getUrls()"> <p class="hotfix-spacing"><a-clip href="{{url}}" target="_new_{{url}}">Visit database</a-clip></p> </div>
        </div>
        <div class="right"> <button class="green" ng-click="vm.addAnnotation()">Add</button> </div>
      </article>
    </section>
  </contentwrapper>
</sectionbox>
